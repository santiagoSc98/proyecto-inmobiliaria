<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </head>
    <body>
    
          <div id="main">
            <div id="modlogreg">
                <div id="modallogin">
                    <h1>Login</h1>
                    <form action="/login" method="post" id="login">
                        <label for="email">email:</label><br>
                        <input type="email" required name="email"><br>
            
                        <label for="pass">pass:</label><br>
                        <input type="password" required name="pass" ><br><br>
            
                        <input type="submit" value="Submit">
                    </form>
                </div>
                <div id="modalregister">
                    <h1>Register</h1>
                    <form action="/register" id="register" method="post">
                        <select name="tipo">
                            <option value="1">Cliente</option>
                            <option value="2">Agencia</option>
                        </select><br>
                        <label for="nombre">Nombre completo:</label><br>
                        <input type="text" name="nombre"><br>
            
                        <label for="telefono">telefono:</label><br>
                        <input type="number" name="telefono"><br>
            
                        <label for="direccion">direccion:</label><br>
                        <input type="text" name="direccion"><br>
            
                        <label for="descripcion">descripcion:</label><br>
                        <input type="text" name="descripcion"><br>
            
                        <label for="dni">Dni :</label><br>
                        <input type="text" name="dni"><br>
            
                        <label for="email">email:</label><br>
                        <input type="email" name="email"><br>
            
                        <label for="pass">pass:</label><br>
                        <input type="password" name="pass" ><br><br>
                        
                        <input type="submit" value="Submit">
                    </form> 
                </div>
            </div>
            <div id="listado" style="display:none;">
                <h2>Listado</h2>
                <a id="cerrar" href="#">cerrar</a>
            </div>
          </div>

    </body>
    <script>
        
     $("#login").submit(function(e) {

        e.preventDefault(); 

        var form = $(this);
        var actionUrl = form.attr('action');

        if(localStorage.getItem("token")!=null){
        $.ajax({
                type: "POST",
                url: "listado", 
                data: {"token":localStorage.getItem("token")}, 
                success: function(data2){
                    console.log(data2)
                }
            })
        } else{

            $.ajax({
            type: "POST",
            url: actionUrl,
            data: form.serialize(), 
            success: function(data)
            {
                console.log("Respuesta",data[0].status)
                if (data[0].status == 200){

                    $("#modlogreg").hide();
                    $("#listado").show();

                    $.ajax({
                        type: "POST",
                        url: "listado",
                        data: {"token":data[0].token}, 
                        success: function(data2){
                            console.log(data2)
                        }
                    })

                    localStorage.setItem("token",data[0].token);

                } else if(data[0].status == 0){

                    console.log("japiro")

                } 
            }});

        }
    });

    $("#register").submit(function(e) {
     
            $.ajax({
            type: "POST",
            url: actionUrl,
            data: form.serialize(), 
            success: function(data)
            {
                if(data[0].status == 200){

                    localStorage.setItem("token",data[0].token);
                    $("#modlogreg").hide();
                    $("#listado").show();

                } else {
                    console.log(" existe un usuario con ese email ");
                }
               
            }});
    })

    $(document).ready(function(e) { 
        // AutoLogin
        if(localStorage.getItem("token")!=null){
            $.ajax({
                type: "POST",
                url: "listado", 
                data: {"token":localStorage.getItem("token")}, 
                success: function(data2){
                    console.log(data2)
                    $("#modlogreg").hide();
                    $("#listado").show();
                }
            })
        }
    });
    $("#cerrar").click (function(){
        localStorage.clear(); 
        $("#modlogreg").show();
        $("#listado").hide();
        console.log("cerraste sesion");
    })
    </script>
</html>